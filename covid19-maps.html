<!doctype html><html><head><meta charset="UTF-8"><meta content="IE=edge" http-equiv="X-UA-Compatible"><meta content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,viewport-fit=cover,user-scalable=no" name="viewport"><title>COVID-19 中醫視訊診療地圖</title><meta content="COVID-19 中醫視訊診療地圖" name="description"><meta content="COVID-19 中醫視訊診療地圖" property="og:description"><meta content="zh_TW" property="og:locale"><meta content="微程式資訊 創新前瞻計畫室" property="og:site_name"><meta content="COVID-19 中醫視訊診療地圖" property="og:title"><meta content="website" property="og:type"><link href="https://unpkg.com/bootstrap@4/dist/css/bootstrap.min.css" rel="stylesheet"><link href="https://unpkg.com/font-awesome@4/css/font-awesome.min.css" rel="stylesheet"><link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet"><style>[v-cloak]{display:none}.h1,.h2,.h3,.h4,.h5,.h6,body,h1,h2,h3,h4,h5,h6{font-family:"Noto Sans TC",sans-serif}</style><meta content="COVID-19 中醫視訊診療地圖" name="description"><link href="https://i.imgur.com/zw85148.png" rel="icon" type="image/x-icon"><link href="https://i.imgur.com/zw85148.png" rel="shortcut icon"><meta content="COVID-19 中醫視訊診療地圖" property="og:description"><meta content="256" property="og:image:height"><meta content="256" property="og:image:width"><meta content="https://i.imgur.com/zw85148.png" property="og:image"><link href="https://unpkg.com/leaflet@1/dist/leaflet.css" rel="stylesheet"><link href="https://unpkg.com/leaflet.locatecontrol/dist/L.Control.Locate.min.css" rel="stylesheet"><link href="https://unpkg.com/leaflet.markercluster@1/dist/MarkerCluster.css" rel="stylesheet"><link href="https://unpkg.com/leaflet.markercluster@1/dist/MarkerCluster.Default.css" rel="stylesheet"><style>[v-cloak]{display:none}#app,#map,body,html{height:100%;width:100vw}#app{position:relative}#layer-visible{background-color:#fff;padding:.3rem .5rem;position:absolute;right:10px;top:10px}.img-logo{height:40px}.custom-control-label{font-size:14px}.unselectable{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.leaflet-popup-content{font-size:14px}.leaflet-popup-content h6{font-size:18px}.leaflet-popup-content .table-popup th{padding:.3rem 0;white-space:nowrap}.location-circle-tooltip.leaflet-tooltip{background:0 0;border:none;box-shadow:none}.location-circle-tooltip.leaflet-tooltip-top:before{border:none}.marker-cluster-testkits{background-color:rgba(248,208,121,.6)}.marker-cluster-testkits>div{background-color:rgba(248,208,121,.6)}.marker-cluster-tcmTelemedicines{background-color:rgba(117,202,229,.6)}.marker-cluster-tcmTelemedicines>div{background-color:rgba(117,202,229,.6)}.icon-info{bottom:-38px;position:absolute;right:5px}.red-dot{background-color:red;border-radius:99px;height:8px;position:absolute;right:0;top:2px;width:8px}</style></head><body><script src="https://www.googletagmanager.com/gtag/js?id=G-V7N3FVMHRM" async></script><script>function gtag(){window.dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-V7N3FVMHRM",{send_page_view:!1});</script><div id="app" v-cloak><div class="leaflet-bar leaflet-control text-monospace unselectable" id="layer-visible"><div class="d-flex flex-column mt-1 pt-1" v-if="open"><div class="d-flex mx-auto"><img @click="btnLogo('mp')" class="img-logo mx-2" src="https://i.imgur.com/q7z7Ofg.png"><img @click="btnLogo('twtm')" class="img-logo mx-2" src="https://i.imgur.com/hMSeLCE.png"><img @click="btnLogo('tcm')" class="img-logo mx-2" src="https://i.imgur.com/Z9dDtNJ.png"></div></div><div class="d-flex"><small @click="open = !open" class="mx-auto">{{ open ? '收合' : '展開' }}</small><i @click="btnInfo" class="fa fa-2x fa-info-circle icon-info text-primary"><div class="red-dot" v-if="h.contentVersion !== info.contentVersion"></div></i></div></div><div id="map"></div></div><script src="https://unpkg.com/axios/dist/axios.min.js" crossorigin="anonymous"></script><script src="https://unpkg.com/dayjs/dayjs.min.js" crossorigin="anonymous"></script><script src="https://unpkg.com/jquery@3/dist/jquery.min.js" crossorigin="anonymous"></script><script src="https://unpkg.com/json5@2/dist/index.min.js" crossorigin="anonymous"></script><script src="https://unpkg.com/lodash@4/lodash.min.js" crossorigin="anonymous"></script><script src="https://unpkg.com/papaparse@5/papaparse.min.js" crossorigin="anonymous"></script><script src="https://unpkg.com/popper.js@1/dist/umd/popper.min.js" crossorigin="anonymous"></script><script src="https://unpkg.com/qs@6/dist/qs.js" crossorigin="anonymous"></script><script src="https://unpkg.com/sweetalert2@11" crossorigin="anonymous"></script><script src="https://unpkg.com/vue@2/dist/vue.min.js" crossorigin="anonymous"></script><script src="https://unpkg.com/bootstrap@4/dist/js/bootstrap.min.js" crossorigin="anonymous"></script><script src="https://campagin.program.com.tw/js/common.js?cachebust=1713927155263"></script><script src="https://unpkg.com/@hapi/joi@17/dist/joi-browser.min.js" crossorigin="anonymous"></script><script src="https://unpkg.com/leaflet@1/dist/leaflet.js" crossorigin="anonymous"></script><script src="https://unpkg.com/leaflet.locatecontrol/dist/L.Control.Locate.min.js" crossorigin="anonymous"></script><script src="https://unpkg.com/leaflet.markercluster@1/dist/leaflet.markercluster.js" crossorigin="anonymous"></script><script>let map;window.httpBuildQuery=t=>Qs.stringify(t,{arrayFormat:"brackets"}),window.sleep=e=>new Promise(t=>{setTimeout(t,e)}),window.vm=new Vue({el:"#app",data:{nameMap:{tcmTelemedicines:"中醫視訊診所查詢"},mapZoom:15,open:!0,info:{contentVersion:2,version:"v3.0"},h:{contentVersion:0}},async mounted(){try{var t=JSON.parse(localStorage.getItem(location.pathname));t&&this.$set(this,"h",{...this.h,...t})}catch(t){}this.$watch("h",()=>{localStorage.setItem(location.pathname,JSON.stringify(this.h))},{deep:!0});try{gtag("event","screen_view",{screen_name:"Covid 19 快篩試劑及中醫診所地圖"}),this.initMap(),this.init()}catch(t){}},methods:{async initMap(){var t=L.tileLayer("https://{s}.basemaps.cartocdn.com/rastertiles/light_all/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, &copy; <a href="https://carto.com/attribution">CARTO</a>'});map=L.map("map",{center:[24.1591423,120.6396484],zoom:15,layers:[t],tap:!1}),window.Lcontrol=L.control.locate({position:"topleft",strings:{title:"定位目前所在位置",popup:"定位目前所在位置"}}).addTo(map),map.on("zoomend",()=>{this.mapZoom=map.getZoom()})},async init(){this.showLoading("讀取中","請稍候");var t=await this.getTcms("https://docs.google.com/spreadsheets/d/e/2PACX-1vT8DLtC15TFAUZouFmbL6KrqTKSrMdYKPaMAHNQs2wZIvYcicKzw_z37qREC2Ae-OfFliL3wG0ktzqy/pub?gid=1114924453&single=true&output=csv");await this.renderMap({tcmTelemedicines:t}),Swal.close()},btnLogo(t){gtag("event","logo_click",{company:t});let e;"mp"===t&&(e="https://www.program.com.tw/"),"tcm"===t&&(e="https://www.new-tccma.org.tw/"),"twtm"===t&&(e="http://www.twtm.tw/"),location.href=e},async btnInfo(){var{contentVersion:t,version:e}=this.info;gtag("event","info_click",{contentVersion:t,version:e}),this.$set(this.h,"contentVersion",t),await Swal.fire({title:"相關資訊",html:`<div class="text-monospace text-left">
          <p class="mt-0 mb-2"><strong>資料來源</strong>
          <ul class="pl-4 my-1">
            <li><small>中華民國中醫師公會全國聯合會<a href="tel:'02-29594939'">(02)2959-4939</a></small></li>
            <li><small><a href="https://data.nhi.gov.tw/">健康保險資料開放服務</a></small></li>
          </ul>
          <p class="mt-0 mb-2"><strong>版本：</strong>${e}</p>
        </div>`})},async renderMap(t){console.log(t);const o=t=>"tel:"+t.replace(/^[(]*(\d+)[)\s-]*(\d+)$/,"$1-$2"),i=t=>{t={api:1,destination:t.lat+","+t.lng,travelmode:"walking"};return"https://www.google.com/maps/dir/?"+window.httpBuildQuery(t)};_.each(t,async(t,e)=>{const n="marker-cluster marker-cluster-"+e;t=L.markerClusterGroup({chunkedLoading:!0,disableClusteringAtZoom:15,spiderfyOnMaxZoom:!1,iconCreateFunction:t=>new L.DivIcon({className:n,html:`<div><span>${t.getChildCount()}</span></div>`,iconSize:new L.Point(40,40)})}).addLayers(_.map(t,t=>{return L.marker([t.lat,t.lng],{icon:this.getIcon(t,e)}).bindPopup(((t,e)=>{const n=$("<div />");var a=`<h6 class="mb-0 text-center font-weight-bold">${t.name}</h6><hr class="my-2">
          <div class="text-monospace">
            <p class="mt-0 mb-2 text-center text-danger font-weight-bold">視訊診療，經醫師診斷開立清冠一號(公費)</p>
            ${t.phone?`<p class="mt-0 mb-2"><strong>電話：</strong><a href="${o(t.phone)}">${t.phone}</a></p>`:""}
            <p class="mt-0 mb-2"><strong>地址：</strong>${t.address}</p>
            <a class="btn btn-dark btn-sm btn-block text-white my-auto btn-block onclick-maps", href="${i(t)}", target="_blank">Google 導航</a>
          </div>`;return n.on("click",".onclick-maps",()=>{gtag("event","click",{link_id:e+"_"+t.name})}),n.html(a),n[0]})(t,e),{minWidth:200}).on("click",()=>{gtag("event","icon_click",{store_type_name:e+"_"+t.name})})}));map.addLayer(t)}),window.Lcontrol.start()},getIcon(t,e){const n=L.Icon.extend({options:{iconAnchor:[20,37],iconSize:[40,40],popupAnchor:[0,-40]}});var a={empty:new n({iconUrl:"https://i.imgur.com/jH9Ll7g.png"}),tcmTelemedicines:new n({iconUrl:"https://i.imgur.com/Dty9gl7.png"}),testkits:new n({iconUrl:"https://i.imgur.com/RRD8neI.png"})};return"testkits"!==e?a[e]:_.get(t,"count",0)?a.testkits:a.empty},async getTestkits(){var t=await this.fetchCsvCors("https://data.nhi.gov.tw/resource/Nhi_Fst/Fstdata.csv");return _.filter(await Promise.all(_.map(t,async t=>{try{return t={address:t["醫事機構地址"],count:t["快篩試劑截至目前結餘存貨數量"],id:t["醫事機構代碼"],label:t["廠牌項目"],lat:t["緯度"],lng:t["經度"],name:t["醫事機構名稱"],phone:t["醫事機構電話"],ps:t["備註"],updated_at:t["來源資料時間"]},await joi.object({address:joi.string().empty("").optional(),count:joi.number().integer().min(0).default(0).empty(""),id:joi.string().required(),label:joi.string().empty("").required(),lat:joi.number().min(21).max(28).empty("0").required(),lng:joi.number().min(117).max(123).empty("0").required(),name:joi.string().empty("").required(),phone:joi.string().empty("").optional(),ps:joi.string().empty("").optional(),updated_at:joi.string().regex(/^\d{4}\/\d{2}\/\d{2} \d{2}:\d{2}:\d{2}/).required()}).validateAsync(t,{stripUnknown:!0})}catch(t){return console.error(t),null}})))},async getTcms(t){return t?(t=await this.fetchCsvCors(t),_.filter(await Promise.all(_.map(t,async e=>{try{return e=_.pick(e,["address","lat","lng","name","phone","open"]),await joi.object({address:joi.string().empty("").optional(),lat:joi.number().min(21).max(28).empty("0").required(),lng:joi.number().min(117).max(123).empty("0").required(),name:joi.string().empty("").required(),open:joi.number().valid(0,1).required(),phone:joi.string().empty("").optional()}).validateAsync(e,{stripUnknown:!0})}catch(t){return console.log(`解析格式錯誤: ${e}, 錯誤訊息: `+t),console.error(t),null}})),{open:1})):[]},async getTestkitsAll(){var t=await this.fetchCsvCors("https://taichunmin.idv.tw/covid19-testkit-maps-crawler/stores0430.csv");return _.map(t,t=>({address:t.addr,count:0,id:t.id,label:t.testkit,lat:t.lat,lng:t.lng,name:t.name,phone:t.tel,ps:t.notice,total:t.amount}))},async fetchCsvCors(t,e=3e5){(t=new URL(t)).searchParams.set("cachebust",_.floor(Date.now()/e));e=_.trim(_.get(await axios.get("https://us-central1-youbike2-linebot.cloudfunctions.net/cors-anywhere",{params:{u:t.href}}),"data"));return _.get(Papa.parse(e,{encoding:"utf8",header:!0}),"data",[])},showLoading(t,e){Swal.fire({title:t,text:e,allowOutsideClick:!1,showConfirmButton:!1,willOpen:()=>{Swal.showLoading()}})}}});</script></body></html>